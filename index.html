<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>OSA-MA MA版</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 800px;
    margin: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    padding: 8px;
    text-align: center;
    vertical-align: middle;
  }

  th.scale {
    font-size: 0.9em;
    color: #555;
  }

  td.left-label,
  td.right-label {
    width: 20%;
    font-size: 0.9em;
    text-align: left;
  }

  td.right-label {
    text-align: right;
  }

  td.choice {
    width: 10%;
  }

  input[type="radio"] {
    transform: scale(1.2);
  }

  @media (max-width: 600px) {
    td.left-label,
    td.right-label {
      font-size: 0.8em;
    }
  }

tbody tr {
  border-bottom: 1px solid #ddd;
}

tbody tr:last-child {
  border-bottom: none;
}


</style>
</head>

<body>

<h2>OSA-MA 睡眠調査票</h2>

<!-- 被験者ID -->
<p>
  被験者ID：
  <input type="text" id="subject_id" required>
</p>

<form id="osaForm">

<!-- 教示・時刻入力ブロック -->
<div class="instruction-block">

  <p class="instruction-main">
    朝，目覚めたらすぐに入力して下さい
  </p>

  <p class="instruction-sub">
    この調査票は，あなたの睡眠の状態についてお聞きするものです．

  </p>

  <div class="time-input">
    <label for="rest_time">昨夜，おやすみになった時刻※24時間表記：</label>
    <input type="time" id="rest_time" name="rest_time" required>
  </div>

  <div class="time-input">
    <label for="wake_time">今朝，目覚めた時刻※24時間表記：</label>
    <input type="time" id="wake_time" name="wake_time" required>
  </div>

  <div class="time-input">
    <label for="sleep_time">昨夜の睡眠時間：</label>
    <input type="time" id="sleep_time" name="sleep_time" required>
  </div>

</div>


<table>

    <p class="instruction-sub">
    昨夜の睡眠の状態や現在の心身の状態についてお聞きします．<br>
    あなたの状態にあてはまる箇所にチェックを入れて下さい．

  </p>

  <!-- 尺度ヘッダー（1回だけ） -->
  <thead>
    <tr>
      <th></th>
      <th class="scale">非常に</th>
      <th class="scale">やや</th>
      <th class="scale">やや</th>
      <th class="scale">非常に</th>
      <th></th>
    </tr>
  </thead>

  <tbody>

    <!-- Q1 -->
    <tr>

      <td class="left-label">疲れが残っている</td>

      <td class="choice">
        <input type="radio" name="q1" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q1" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q1" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q1" value="4">
      </td>

      <td class="right-label">疲れがとれている</td>
    </tr>

    <!-- Q2 -->
    <tr>
      <td class="left-label">集中力がある</td>

      <td class="choice">
        <input type="radio" name="q2" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q2" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q2" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q2" value="4">
      </td>

      <td class="right-label">集中力がない</td>
    </tr>

    <!-- Q3 -->
    <tr>
      <td class="left-label">ぐっすり眠れた</td>

      <td class="choice">
        <input type="radio" name="q3" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q3" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q3" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q3" value="4">
      </td>

      <td class="right-label">ぐっすり眠れなかった</td>
    </tr>

    <!-- Q4 -->
    <tr>
      <td class="left-label">解放感がある</td>

      <td class="choice">
        <input type="radio" name="q4" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q4" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q4" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q4" value="4">
      </td>

      <td class="right-label">ストレスを感じる</td>
    </tr>

    <!-- Q5 -->
    <tr>
      <td class="left-label">身体がだるい</td>

      <td class="choice">
        <input type="radio" name="q5" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q5" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q5" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q5" value="4">
      </td>

      <td class="right-label">身体がシャキッとしている</td>
    </tr>

    <!-- Q6 -->
    <tr>
      <td class="left-label">食欲がある</td>

      <td class="choice">
        <input type="radio" name="q6" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q6" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q6" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q6" value="4">
      </td>

      <td class="right-label">食欲がない</td>
    </tr>

    <!-- Q7 -->
    <tr>
      <td class="left-label">寝つくまでにウトウトしていた状態が多かった</td>

      <td class="choice">
        <input type="radio" name="q7" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q7" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q7" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q7" value="4">
      </td>

      <td class="right-label">寝つくまでにウトウトしていた状態が少なかった</td>
    </tr>

    <!-- Q8 -->
    <tr>
      <td class="left-label">頭がはっきりしている</td>

      <td class="choice">
        <input type="radio" name="q8" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q8" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q8" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q8" value="4">
      </td>

      <td class="right-label">頭がボーとしている</td>
    </tr>

    <!-- Q9 -->
    <tr>
      <td class="left-label">悪夢が多かった</td>

      <td class="choice">
        <input type="radio" name="q9" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q9" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q9" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q9" value="4">
      </td>

      <td class="right-label">悪夢は見なかった</td>
    </tr>

    <!-- Q10 -->
    <tr>
      <td class="left-label">寝つきがよかった</td>

      <td class="choice">
        <input type="radio" name="q10" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q10" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q10" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q10" value="4">
      </td>

      <td class="right-label">寝つきが悪かった</td>
    </tr>

    <!-- Q11 -->
    <tr>
      <td class="left-label">不快な気分である</td>

      <td class="choice">
        <input type="radio" name="q11" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q11" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q11" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q11" value="4">
      </td>

      <td class="right-label">さわやかな気分である</td>
    </tr>

    <!-- Q11 -->
    <tr>
      <td class="left-label">しょっちゅう夢をみた</td>

      <td class="choice">
        <input type="radio" name="q12" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q12" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q12" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q12" value="4">
      </td>

      <td class="right-label">夢をみなかった</td>
    </tr>

    <!-- Q10 -->
    <tr>
      <td class="left-label">睡眠中にしょっちゅう目が覚めた</td>

      <td class="choice">
        <input type="radio" name="q13" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q13" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q13" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q13" value="4">
      </td>

      <td class="right-label">睡眠中に目が覚めなかった</td>
    </tr>

    <!-- Q10 -->
    <tr>
      <td class="left-label">いますぐ，調査にテキパキと答えられる</td>

      <td class="choice">
        <input type="radio" name="q14" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q14" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q14" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q14" value="4">
      </td>

      <td class="right-label">答えるのは，めんどうである</td>
    </tr>

    <!-- Q10 -->
    <tr>
      <td class="left-label">睡眠時間が長かった</td>

      <td class="choice">
        <input type="radio" name="q15" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q15" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q15" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q15" value="4">
      </td>

      <td class="right-label">睡眠時間が短かった</td>
    </tr>

    <!-- Q10 -->
    <tr>
      <td class="left-label">眠りが浅かった</td>

      <td class="choice">
        <input type="radio" name="q16" value="1" required>
      </td>
      <td class="choice">
        <input type="radio" name="q16" value="2">
      </td>
      <td class="choice">
        <input type="radio" name="q16" value="3">
      </td>
      <td class="choice">
        <input type="radio" name="q16" value="4">
      </td>

      <td class="right-label">眠りが深かった</td>
    </tr>

  </tbody>
</table>

<br>
<button type="submit">送信</button>

</form>

<script>
// ===== URLパラメータから被験者IDを取得 =====
function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

const subjectIdFromUrl = getQueryParam("sid");

if (subjectIdFromUrl) {
  const subjectInput = document.getElementById("subject_id");
  subjectInput.value = subjectIdFromUrl;
  subjectInput.readOnly = true;
}


  const inputStartTime = new Date().toISOString();

  document.getElementById("osaForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const submitTime = new Date().toISOString();

    const formData = new FormData(e.target);
    const answers = {};
    for (const [key, value] of formData.entries()) {
      answers[key] = Number(value);
    }

    const payload = {
      subject_id: document.getElementById("subject_id").value,
      input_start_time: inputStartTime,
      submit_time: submitTime,
      answers: answers
    };

    console.log(payload);

    console.log(payload);

fetch("https://script.google.com/macros/s/AKfycbyz3WYbRfKYcE3Nx_H-ziP-e305G0-jdSBJfbuJRLpmEVX7ZsflIBqbik1dNUeXK5-MtQ/exec", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify(payload)
})
.then(response => response.text())
.then(result => {
  alert("送信が完了しました");
  console.log(result);
})
.catch(error => {
  alert("送信に失敗しました");
  console.error(error);
});

  });
</script>

</body>
</html>


